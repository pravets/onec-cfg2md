# Техническое задание: Конвертер метаданных 1С в Markdown

## 1. Общее описание

Программа предназначена для конвертации метаданных конфигурации 1С в формат Markdown с целью создания документации для использования в Model Context Protocol (MCP).

## 2. Функциональные требования

### 2.1 Поддерживаемые форматы исходных данных

Программа должна поддерживать два формата метаданных 1С:

1. **CFG формат (Конфигуратор)**
   - Маркер формата: файл `Configuration.xml` в корневом каталоге
   - Структура: XML файлы с пространствами имен `v8:`, `xr:`
   - Расположение объектов: `Documents/*.xml`, `Catalogs/*.xml`, etc.

2. **EDT формат (Eclipse Development Tools)**
   - Маркеры формата: файл `.project` в корневом каталоге + подкаталог `src/`
   - Структура: XML файлы с пространствами имен `mdclass:`, `core:`
   - Расположение объектов: `src/Documents/*/объект.mdo`, `src/Catalogs/*/объект.mdo`, etc.

### 2.2 Типы метаданных для обработки

В первой версии программа должна обрабатывать:
- **Документы** (Documents)
- **Справочники** (Catalogs) 
- **Перечисления** (Enums)
- **Планы видов характеристик** (ChartsOfCharacteristicTypes)

### 2.3 Выходные форматы

1. **Markdown файлы** - по одному файлу на каждый объект метаданных
2. **CSV каталог** - сводная таблица всех объектов

## 3. Структура выходных данных

### 3.1 Формат Markdown файла

```markdown
# Тип_объекта: Имя_объекта (Синоним)

## Реквизиты шапки

- Имя_реквизита (Тип_данных)
- ...

## Табличные части

### Имя_табличной_части (Синоним_табличной_части)

- Имя_реквизита_ТЧ (Тип_данных)
- ...
```

### 3.2 Преобразование типов данных

| Тип в метаданных | Тип в Markdown |
|------------------|----------------|
| `CatalogRef.Имя` | `Справочник.Имя` |
| `DocumentRef.Имя` | `Документ.Имя` |
| `EnumRef.Имя` | `Перечисление.Имя` |
| `ChartOfCharacteristicTypesRef.Имя` | `ПланВидовХарактеристик.Имя` |
| `String` | `Строка` |
| `Boolean` | `Булево` |
| `Date` | `Дата` |
| `Number` | `Число` |
| `DefinedType.Имя` | `ОпределяемыйТип.Имя` |

### 3.3 Формат CSV каталога

```csv
Имя объекта;Тип объекта;Синоним;Файл
Документ.АвансовыйОтчет;Документ;Авансовый отчет;Документ_АвансовыйОтчет.md
```

## 4. Архитектура программы

### 4.1 Модульная структура

```
├── cmd/
│   └── root.go              // CLI интерфейс
├── pkg/
│   ├── detector/
│   │   └── format.go        // Определение формата (CFG/EDT)
│   ├── parser/
│   │   ├── interface.go     // Общий интерфейс парсера
│   │   ├── cfg_parser.go    // Парсер CFG формата
│   │   └── edt_parser.go    // Парсер EDT формата
│   ├── model/
│   │   └── metadata.go      // Структуры метаданных
│   └── generator/
│       ├── markdown.go      // Генератор MD
│       └── csv.go           // Генератор CSV каталога
```

### 4.2 Основные компоненты

1. **Детектор формата** - определяет тип исходных данных (CFG/EDT)
2. **Парсер** - извлекает метаданные из XML файлов
3. **Модель данных** - унифицированное представление метаданных
4. **Генераторы** - создают выходные файлы в нужном формате

## 5. Интерфейс командной строки

### 5.1 Основная команда

```bash
ones-cfg2md [flags] <source_directory> <output_directory>
```

### 5.2 Параметры

- `source_directory` - путь к каталогу с исходными метаданными
- `output_directory` - путь к каталогу для сохранения результатов
- `--format` - принудительное указание формата (cfg/edt), по умолчанию автоопределение
- `--types` - типы объектов для обработки (documents,catalogs,enums), по умолчанию все
- `--verbose` - подробный вывод процесса обработки

### 5.3 Примеры использования

```bash
# Обработка всех объектов с автоопределением формата
ones-cfg2md ./src ./output

# Обработка только документов в CFG формате
ones-cfg2md --format=cfg --types=documents ./cfg ./docs

# Подробный режим
ones-cfg2md --verbose ./edt-project ./documentation
```

## 6. Технические требования

### 6.1 Язык программирования
- Go 1.21+

### 6.2 Зависимости
- `github.com/spf13/cobra` - для CLI интерфейса
- `encoding/xml` - для парсинга XML (стандартная библиотека)
- `golang.org/x/text` - для работы с кодировками

### 6.3 Производительность
- Программа должна обрабатывать конфигурации размером до 10000 объектов за время не более 30 секунд
- Использование памяти не должно превышать 500 МБ

## 7. Обработка ошибок

### 7.1 Типы ошибок
- Некорректный формат исходных данных
- Отсутствие необходимых файлов
- Ошибки парсинга XML
- Ошибки записи выходных файлов

### 7.2 Стратегия обработки
- При ошибке парсинга отдельного объекта - пропуск объекта с выводом предупреждения
- При критических ошибках - завершение работы с кодом ошибки
- Логирование всех ошибок и предупреждений

## 8. Тестирование

### 8.1 Тестовые данные
- Примеры CFG формата в каталоге `examples/cfg/`
- Примеры EDT формата в каталоге `examples/edt/`
- Эталонные выходные файлы для сравнения

### 8.2 Виды тестов
- Unit тесты для каждого модуля
- Интеграционные тесты полного цикла конвертации
- Тесты производительности на больших конфигурациях

## 9. Этапы разработки

### Этап 1: MVP
- Детектор формата (CFG/EDT)
- Парсер документов для обоих форматов
- Генератор Markdown
- Базовый CLI интерфейс

### Этап 2: Расширение
- Поддержка справочников
- Поддержка перечислений
- Генератор CSV каталога
- Улучшенная обработка ошибок

### Этап 3: Оптимизация
- Поддержка планов видов характеристик
- Оптимизация производительности
- Расширенные возможности CLI

## 10. Ограничения первой версии

- Поддержка только русскоязычных метаданных
- Обработка только основных типов объектов
- Отсутствие поддержки модулей и форм
- Простое преобразование типов без учета сложных случаев